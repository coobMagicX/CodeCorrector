Intent: The test case `testNonFiniteDoublesWhenLenient` aims to verify that the `JsonWriter` can successfully write non-finite double values (NaN, negative infinity, positive infinity) into a JSON array when the writer is set to lenient mode. This mode should allow non-standard JSON values like NaN and infinity, which are typically not allowed in strict JSON representations.

Repair strategy: Modify the `JsonWriter` class to check whether the writer is in lenient mode before throwing an exception for non-finite numbers. If the writer is lenient, it should bypass the exception and allow the writing of NaN, negative infinity, and positive infinity. Additionally, adjustments might be needed in the `beforeValue` and `out.append` methods to correctly format these non-finite values as strings in the resulting JSON output.