Intent: The intent of the test case `testKeepsPreTextAtDepth` is to verify that the `preserveWhitespace` function correctly identifies and preserves whitespace within nested HTML elements wrapped within a `<pre>` tag. The test ensures that text formatting, particularly the preservation of new lines and spaces, is maintained as it is crucial in elements like `<pre>` and `<code>` for displaying code or preformatted text.

Repair strategy: The repair should involve modifying the `preserveWhitespace` function to correctly handle nested elements by recursively checking each parent node up to the root or until a node that requires whitespace preservation (like `<pre>` or `<code>`) is found. The function currently checks only one level up for the parent's tag, which is insufficient for deeply nested structures. The recursion or iteration should continue up the DOM tree to ensure that any parent node (not just the immediate parent) can influence the whitespace preservation logic.