Intent: The purpose of this code is to extract multiline textual blocks from Javascript documentation (JsDoc). It reads the content line by line, handling different cases of tokens such as end of file, end of line, and annotations. It also handles special cases such as ASCII art in license comments. It seems the code is designed to preserve whitespace, and it checks whether to include stars in the comments or ignore them.

Fix strategy: The failing test case shows that the extracted result is not equal to the expected result. The issue could be due to the handling of whitespace or the '@preserve' annotation. Check how the '@preserve' annotation is handled in the code. Also, investigate how ASCII art is processed, especially the handling of whitespace and line breaks. Consider updating the extraction logic to ensure the preservation of the original formatting when the '@preserve' annotation is present.